<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/jun1.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/jun.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/jun.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.5.0',
    sidebar: {"position":"right","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="工程说明 本工程有严格代码规范和类型检查约束，如果代码格式或者是类型检查出错，会导致工程build失败。 本工程代码提交会自动部署和maven打包并发布到公司的maven仓库。   jenkins配置在工程根路径的Jenkinsfile文件：&amp;#123;.line-numbers,.bolder,highlight12345678910111213141516171819202122stages">
<meta name="keywords" content="css javascript html html5 css3 布局 前端优化 性能优化 自适应 flex 继承 ES6 sass 姚俊的博客">
<meta property="og:type" content="article">
<meta property="og:title" content="我的奋斗史">
<meta property="og:url" content="http://yoursite.com/post/4170581764.html">
<meta property="og:site_name" content="姚俊的博客">
<meta property="og:description" content="工程说明 本工程有严格代码规范和类型检查约束，如果代码格式或者是类型检查出错，会导致工程build失败。 本工程代码提交会自动部署和maven打包并发布到公司的maven仓库。   jenkins配置在工程根路径的Jenkinsfile文件：&amp;#123;.line-numbers,.bolder,highlight12345678910111213141516171819202122stages">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-04-04T08:38:45.115Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我的奋斗史">
<meta name="twitter:description" content="工程说明 本工程有严格代码规范和类型检查约束，如果代码格式或者是类型检查出错，会导致工程build失败。 本工程代码提交会自动部署和maven打包并发布到公司的maven仓库。   jenkins配置在工程根路径的Jenkinsfile文件：&amp;#123;.line-numbers,.bolder,highlight12345678910111213141516171819202122stages">



  <link rel="alternate" href="/atom.xml" title="姚俊的博客" type="application/atom+xml">




  <link rel="canonical" href="http://yoursite.com/post/4170581764.html">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>我的奋斗史 | 姚俊的博客</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">姚俊的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-projects">

    
    
    
      
    

    

    <a href="/projects/" rel="section"><i class="menu-item-icon fa fa-fw fa-html5"></i> <br>项目</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/post/4170581764.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胖胖">
      <meta itemprop="description" content="生命不息奋斗不止">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="姚俊的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">我的奋斗史
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-21 23:55:00" itemprop="dateCreated datePublished" datetime="2019-04-21T23:55:00+08:00">2019-04-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-04-04 16:38:45" itemprop="dateModified" datetime="2020-04-04T16:38:45+08:00">2020-04-04</time>
              
            
          </span>

          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="工程说明"><a href="#工程说明" class="headerlink" title="工程说明"></a>工程说明</h2><ol>
<li>本工程有严格代码规范和类型检查约束，如果代码格式或者是类型检查出错，会导致工程build失败。</li>
<li>本工程代码提交会自动部署和maven打包并发布到公司的maven仓库。</li>
</ol>
<ul>
<li>jenkins配置在工程根路径的Jenkinsfile文件：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder,highlight</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">stages &#123;</span><br><span class="line">		</span><br><span class="line">		stage(<span class="string">'Distribution-Jenkins-Frontend'</span>) &#123;</span><br><span class="line">            when &#123; branch <span class="string">'v3.3.x-graph-analysis'</span> &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">				sh <span class="string">"/usr/local/n/versions/node/10.16.3/bin/npm config set scripts-prepend-node-path true"</span></span><br><span class="line">				sh <span class="string">'/usr/local/n/versions/node/10.16.3/bin/node /usr/local/n/versions/node/10.16.3/bin/npm install'</span></span><br><span class="line">				sh <span class="string">'/usr/local/n/versions/node/10.16.3/bin/node /usr/local/n/versions/node/10.16.3/bin/npm run build'</span></span><br><span class="line">                sh <span class="string">"/usr/local/bin/sshpass -phadoop ssh -o StrictHostKeyChecking=no hadoop@10.100.2.140 'cd /home/hadoop/rgas_jenkins_cd/v3.3.0/ &amp;&amp; rm -rf bsfit-rgas-frontend/*'"</span></span><br><span class="line">				sh <span class="string">'/usr/local/bin/sshpass -phadoop scp -r -o StrictHostKeyChecking=no target/* hadoop@10.100.2.140:/home/hadoop/rgas_jenkins_cd/v3.3.0/bsfit-rgas-frontend/'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		stage(<span class="string">'Maven-Deploy'</span>) &#123;</span><br><span class="line">            when &#123; branch <span class="string">'v3.3.x-graph-analysis'</span> &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">'echo $JAVA_HOME'</span></span><br><span class="line">				sh <span class="string">'/usr/local/n/versions/node/10.16.3/bin/npm config set scripts-prepend-node-path true &amp;&amp; export JAVA_HOME=/usr/local/jdk1.8.0_101 &amp;&amp; /usr/local/apache-maven-3.5.2/bin/mvn -Dmaven.test.skip=true clean deploy'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>只要修改代码中高亮部分上的branch分支名称，当前是哪个分支你就修改成哪个分支名称即可。</p>
<ul>
<li>maven打包配置在根路径pom.xml文件中：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder,highlight</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> </span><br><span class="line">  xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">  &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;<span class="regexp">/modelVersion&gt;</span></span><br><span class="line"><span class="regexp">  &lt;parent&gt;</span></span><br><span class="line"><span class="regexp">    &lt;groupId&gt;cn.com.bsfit&lt;/g</span>roupId&gt;</span><br><span class="line">    &lt;artifactId&gt;frms-rgas-parent&lt;<span class="regexp">/artifactId&gt;</span></span><br><span class="line"><span class="regexp">    &lt;version&gt;3.3.0&lt;/</span>version&gt;</span><br><span class="line">  &lt;<span class="regexp">/parent&gt;</span></span><br><span class="line"><span class="regexp">  &lt;artifactId&gt;bsfit-rgas-frontend&lt;/</span>artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;<span class="regexp">/packaging&gt;</span></span><br><span class="line"><span class="regexp">  &lt;version&gt;1.0.0&lt;/</span>version&gt;</span><br><span class="line">  &lt;name&gt;front-web&lt;<span class="regexp">/name&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>修改上面代码高亮的版本号即可。</p>
<ol>
<li>本工程开发环境现在默认走向nginx代理，目的是为了后端滚动部署、nginx负载匀衡，从而不会影响前端开发进度。如果你不想走nginx代理可以修改vue.config.js文件如下：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,highlight</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  overlay: &#123;</span><br><span class="line">    warnings: <span class="literal">true</span>,</span><br><span class="line">    errors: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    <span class="string">'/api'</span>: &#123;</span><br><span class="line">      target: <span class="string">'你填入的后端地址'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      ws: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">         <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>上面代码高亮是你需要添加的。</p>
<ol>
<li>工程代码包含大量的注释说明文件，可以快速帮助开发者弄懂各个函数的功能。<h2 id="源码目录设计"><a href="#源码目录设计" class="headerlink" title="源码目录设计"></a>源码目录设计</h2>3.3关联图谱(以下简称3.3)的源码都在 src 目录下，其目录结构如下。<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|-- src</span><br><span class="line">    |-- graph-analysis.d.ts</span><br><span class="line">    |-- shims-tsx.d.ts</span><br><span class="line">    |-- shims-vue-instance.d.ts</span><br><span class="line">    |-- shims-vue.d.ts</span><br><span class="line">    |-- assets</span><br><span class="line">    |-- common</span><br><span class="line">    |-- config</span><br><span class="line">    |   |-- index.ts</span><br><span class="line">    |-- graph-analysis</span><br><span class="line">    |-- management</span><br><span class="line">    |-- types</span><br><span class="line">        |-- bs-view</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>assets:存放工程的字体库、语言包和图片等资源文件</li>
<li>common: 包含整个应用的通用组件、通用指令、通用过滤器、混入、全局样式和一些工具函数</li>
<li>config: 改目录存放应用的一些基本配置，现阶段存放了一些http的url或者是一些跳转链接的url，注意这些url根据打包环境的不同而不同</li>
<li>graph-analysis: 3.3图分析页面的核心代码都在这里，这里先不讲，之后我会抽出一章单独说。</li>
<li>management: 这块现阶段只有模式匹配页面（mode-matching.vue）是可用的,本来规划是把3.3所有都重写，但是历史原因，最终还是没能实现这个伟业。</li>
<li>types: 这个文件主要存放是bsview组件库的类型文档，便于我们开发引入类型进行约束或者是查阅API都可。</li>
<li>.d.ts文件：这些文件是开发者自定义的ts类型文档，现阶段包括图分析的类型文档和tableFormat的类型</li>
</ul>
<p>整个工程包含了两个pages，因此对应的两个打包入口main.ts，分别对应着management和graph-analysis文件夹，相应的配置在工程根目录下的vue.config.js文件中：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pages: &#123;</span><br><span class="line">   index: &#123;</span><br><span class="line">     entry: <span class="string">'src/management/main.ts'</span>,</span><br><span class="line">     template: <span class="string">'public/graph.html'</span>,</span><br><span class="line">     filename:</span><br><span class="line">       process.env.VUE_APP_OUT_PATH === <span class="string">'pages'</span> ? <span class="string">'graph.html'</span> : <span class="string">'index.html'</span>,</span><br><span class="line">     chunks: [<span class="string">'chunk-vendors'</span>, <span class="string">'chunk-common'</span>, <span class="string">'index'</span>]</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">'graph-analysis'</span>: <span class="string">'src/graph-analysis/main.ts'</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></p>
<p>因为从图设计页面到图分析页面是重新打开tab，因此分成两个页面：</p>
<ol>
<li>避免了打开图分析的时候去请求一些图设计相关的资源文件（不如vue-router等）而损耗性能，反之则也成立。</li>
<li>拥有各自的vuex，全局注册组件或者是全局过滤器等，更易于开发者维护和扩展。</li>
</ol>
<h2 id="图分析源码解析"><a href="#图分析源码解析" class="headerlink" title="图分析源码解析"></a>图分析源码解析</h2><h4 id="1-目录结构"><a href="#1-目录结构" class="headerlink" title="1. 目录结构"></a>1. 目录结构</h4><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">|-- graph-analysis</span><br><span class="line">    |-- main.ts</span><br><span class="line">    |-- app</span><br><span class="line">    |   |-- App-add-nodes.service.ts</span><br><span class="line">    |   |-- App-context-menu.service.ts</span><br><span class="line">    |   |-- App-header-menu.service.ts</span><br><span class="line">    |   |-- App.interface.ts</span><br><span class="line">    |   |-- App.scss</span><br><span class="line">    |   |-- App.service.ts</span><br><span class="line">    |   |-- App.vue</span><br><span class="line">    |   |-- event-on.service.ts</span><br><span class="line">    |   |-- base-relation-graph</span><br><span class="line">    |   |-- graph-analysis-header</span><br><span class="line">    |   |-- graph-analysis-right-menu</span><br><span class="line">    |   |-- modal-components</span><br><span class="line">    |-- common</span><br><span class="line">    |   |-- api.ts</span><br><span class="line">    |   |-- bus.ts</span><br><span class="line">    |   |-- utils.ts</span><br><span class="line">    |   |-- components</span><br><span class="line">    |   |   |-- relation-filtering</span><br><span class="line">    |   |       |-- relation-filtering.scss</span><br><span class="line">    |   |       |-- relation-filtering.service.ts</span><br><span class="line">    |   |       |-- relation-filtering.vue</span><br><span class="line">    |   |-- directives</span><br><span class="line">    |   |   |-- auto-table-height.ts</span><br><span class="line">    |   |   |-- index.ts</span><br><span class="line">    |   |-- enums</span><br><span class="line">    |       |-- components-name.ts</span><br><span class="line">    |       |-- menu.ts</span><br><span class="line">    |-- store</span><br><span class="line">    |   |-- index.ts</span><br><span class="line">    |   |-- actions</span><br><span class="line">    |   |   |-- action-types.ts</span><br><span class="line">    |   |   |-- index.ts</span><br><span class="line">    |   |-- mutations</span><br><span class="line">    |       |-- index.ts</span><br><span class="line">    |       |-- mutation-types.ts</span><br><span class="line">    |-- styles</span><br><span class="line">        |-- index.scss</span><br></pre></td></tr></table></figure>
<p>图分析代码中各个组件的样式和相应的.vue文件是分开的，每个组件基本都有一个单独的文件夹来进行管理，相应的子组件会放在父组件的文件夹内部，所以整个组件目录是树状的结构。</p>
<ul>
<li>app文件：图分析的整个组件都放在这里，其中根组件是App.vue，相应的子组件如上图，一个是页面的画布组件base-relation-graph,一个是页面的头部菜单组件graph-analysis-header,最后一个是右边的菜单栏组件graph-analysis-right-menu。因此这三个组件构成了整个图分析的页面，App.vue 模板结构如下：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder,highlight</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;header&gt;</span><br><span class="line">      &lt;graph-analysis-header</span><br><span class="line">        @g-click=<span class="string">"onGclick"</span></span><br><span class="line">        :isShowTip=<span class="string">"isShowTip"</span></span><br><span class="line">        :chartInfo=<span class="string">"chartInfo"</span></span><br><span class="line">      &gt;&lt;/graph-analysis-header&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;main <span class="class"><span class="keyword">class</span></span>=<span class="string">"main"</span>&gt;</span><br><span class="line">      &lt;article <span class="class"><span class="keyword">class</span></span>=<span class="string">"graph-container"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"search-box-container"</span>&gt;</span><br><span class="line">          &lt;Input</span><br><span class="line">            suffix=<span class="string">"ios-search"</span></span><br><span class="line">            placeholder=<span class="string">"请输入节点值进行搜索"</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"search-box"</span></span><br><span class="line">            v-model=<span class="string">"searchValue"</span></span><br><span class="line">            @on-keyup=<span class="string">"inputChange"</span></span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;base-relation-graph</span></span><br><span class="line"><span class="regexp">          :graphOperator="graphOperator"</span></span><br><span class="line"><span class="regexp">        &gt;&lt;/</span>base-relation-graph&gt;</span><br><span class="line">      &lt;<span class="regexp">/article&gt;</span></span><br><span class="line"><span class="regexp">      &lt;aside&gt;</span></span><br><span class="line"><span class="regexp">        &lt;graph-analysis-right-menu&gt;&lt;/g</span>raph-analysis-right-menu&gt;</span><br><span class="line">      &lt;<span class="regexp">/aside&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/m</span>ain&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>还有一个文件夹是modal-components，专门用来存放一些模态框组件的，为了让模态框组件更易于管控和开发，我封装了一个公用的render-dialog容器组件并暴露出了一个openModel方法，具体用法可以相应的看工程中的具体代码，下面给个示例文件App-header-menu.service.ts：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">openModel(<span class="string">'common-neighbor-confirm'</span>, &#123; <span class="attr">title</span>: <span class="string">'共同邻居查找'</span> &#125;).then(</span><br><span class="line">       queryLayer =&gt; &#123;</span><br><span class="line">         context.updateSpinshow(<span class="literal">true</span>);</span><br><span class="line">         Vue.axios</span><br><span class="line">           .post(URL_COMMON_NEIGHBOR, &#123;</span><br><span class="line">             graph: convertGraphDataToServerData(context.elements),</span><br><span class="line">             queryIds: context.graphInfo.selectedElements.nodes.map(</span><br><span class="line">               (inode: INode) =&gt; inode.id</span><br><span class="line">             ),</span><br><span class="line">             queryLayer</span><br><span class="line">           &#125;)</span><br><span class="line">           .then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">             context.updateCommonNeighborNodes(&#123;</span><br><span class="line">               data: data.commonNodeIds,</span><br><span class="line">               isShow: <span class="literal">true</span></span><br><span class="line">             &#125;);</span><br><span class="line">             EventEmit.bus(EventName.UPDATE_COMMON_NEIGHBOR, &#123;</span><br><span class="line">               layer: queryLayer,</span><br><span class="line">               nodeTypes: context.graphInfo.selectedElements.nodes.map(</span><br><span class="line">                 (inode: INode) =&gt; <span class="string">`<span class="subst">$&#123;inode.displayType&#125;</span> (<span class="subst">$&#123;inode.value&#125;</span>)`</span></span><br><span class="line">               ),</span><br><span class="line">               neighbors: &#123;</span><br><span class="line">                 names: [<span class="string">'number'</span>, <span class="string">'type'</span>, <span class="string">'value'</span>, <span class="string">'id'</span>],</span><br><span class="line">                 displayNames: [<span class="string">'编号'</span>, <span class="string">'类型'</span>, <span class="string">'值'</span>, <span class="string">'ID'</span>],</span><br><span class="line">                 data: data.commonNodeIds.map(<span class="function">(<span class="params">id: string, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">                   <span class="keyword">const</span> inode: INode = context.idToElements.get(id) <span class="keyword">as</span> INode;</span><br><span class="line">                   <span class="keyword">return</span> [</span><br><span class="line">                     index + <span class="number">1</span>,</span><br><span class="line">                     inode.displayType,</span><br><span class="line">                     inode.value,</span><br><span class="line">                     inode.id</span><br><span class="line">                   ];</span><br><span class="line">                 &#125;)</span><br><span class="line">               &#125;</span><br><span class="line">             &#125;);</span><br><span class="line">             context.$Message.info(</span><br><span class="line">               <span class="string">`共找到<span class="subst">$&#123;data.commonNodeIds.length&#125;</span>个邻居节点`</span></span><br><span class="line">             );</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     );</span><br></pre></td></tr></table></figure></p>
<p>其中common-neighobr-confirm是你需要自定义的一个弹框组件，并要进行全局注册它。不过这块有个优化点，之前没有考虑到位，就是我们自定义的弹框组件没必要去全局注册，可以按需注册在render-dialog组件内部，所以感兴趣的小伙伴可以对这方面代码进行优化。<br>为了便于小伙伴学习，配一张完整的app文件夹下的目录结构供大家参考：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">|-- app</span><br><span class="line">    |-- App-add-nodes.service.ts</span><br><span class="line">    |-- App-context-menu.service.ts</span><br><span class="line">    |-- App-header-menu.service.ts</span><br><span class="line">    |-- App.interface.ts</span><br><span class="line">    |-- App.scss</span><br><span class="line">    |-- App.service.ts</span><br><span class="line">    |-- App.vue</span><br><span class="line">    |-- event-on.service.ts</span><br><span class="line">    |-- base-relation-graph</span><br><span class="line">    |   |-- base-relation-graph-operator.class.ts</span><br><span class="line">    |   |-- base-relation-graph.interface.ts</span><br><span class="line">    |   |-- base-relation-graph.scss</span><br><span class="line">    |   |-- base-relation-graph.service.ts</span><br><span class="line">    |   |-- base-relation-graph.vue</span><br><span class="line">    |   |-- context-menu</span><br><span class="line">    |   |   |-- context-menu.scss</span><br><span class="line">    |   |   |-- context-menu.vue</span><br><span class="line">    |   |-- styles</span><br><span class="line">    |       |-- base-relation-graph-base-style.ts</span><br><span class="line">    |       |-- base-relation-graph-nodes-style.ts</span><br><span class="line">    |-- graph-analysis-header</span><br><span class="line">    |   |-- graph-analysis-header-interface.ts</span><br><span class="line">    |   |-- graph-analysis-header.scss</span><br><span class="line">    |   |-- graph-analysis-header.service.ts</span><br><span class="line">    |   |-- graph-analysis-header.vue</span><br><span class="line">    |-- graph-analysis-right-menu</span><br><span class="line">    |   |-- graph-analysis-right-menu.scss</span><br><span class="line">    |   |-- graph-analysis-right-menu.vue</span><br><span class="line">    |   |-- analysis-result</span><br><span class="line">    |   |   |-- analysis-result.scss</span><br><span class="line">    |   |   |-- analysis-result.vue</span><br><span class="line">    |   |   |-- common-neighbor</span><br><span class="line">    |   |   |   |-- common-neighbor.scss</span><br><span class="line">    |   |   |   |-- common-neighbor.vue</span><br><span class="line">    |   |   |-- important-node</span><br><span class="line">    |   |   |   |-- important-node.scss</span><br><span class="line">    |   |   |   |-- important-node.vue</span><br><span class="line">    |   |   |-- path-analysis</span><br><span class="line">    |   |       |-- path-analysis.scss</span><br><span class="line">    |   |       |-- path-analysis.vue</span><br><span class="line">    |   |-- base-info</span><br><span class="line">    |   |   |-- base-info.scss</span><br><span class="line">    |   |   |-- base-info.vue</span><br><span class="line">    |   |   |-- detail</span><br><span class="line">    |   |   |   |-- detail.scss</span><br><span class="line">    |   |   |   |-- detail.service.ts</span><br><span class="line">    |   |   |   |-- detail.vue</span><br><span class="line">    |   |   |-- pie-graph</span><br><span class="line">    |   |   |   |-- pie-graph.vue</span><br><span class="line">    |   |   |-- relation-filtering</span><br><span class="line">    |   |   |   |-- relation-filtering.scss</span><br><span class="line">    |   |   |   |-- relation-filtering.vue</span><br><span class="line">    |   |   |-- statistics</span><br><span class="line">    |   |   |   |-- statistics.scss</span><br><span class="line">    |   |   |   |-- statistics.vue</span><br><span class="line">    |   |   |-- view-instruction</span><br><span class="line">    |   |       |-- view-instruction.scss</span><br><span class="line">    |   |       |-- view-instruction.vue</span><br><span class="line">    |   |-- checklist-rules</span><br><span class="line">    |   |   |-- checklist-rules.scss</span><br><span class="line">    |   |   |-- checklist-rules.vue</span><br><span class="line">    |   |-- club-discern</span><br><span class="line">    |   |   |-- club-discern.scss</span><br><span class="line">    |   |   |-- club-discern.vue</span><br><span class="line">    |   |   |-- table-expand-info</span><br><span class="line">    |   |       |-- table-expand-info.scss</span><br><span class="line">    |   |       |-- table-expand-info.vue</span><br><span class="line">    |   |-- common</span><br><span class="line">    |       |-- base-analysis-header</span><br><span class="line">    |           |-- base-analysis-header.scss</span><br><span class="line">    |           |-- base-analysis-header.vue</span><br><span class="line">    |-- modal-components</span><br><span class="line">        |-- add-node</span><br><span class="line">        |   |-- add-node.scss</span><br><span class="line">        |   |-- add-node.vue</span><br><span class="line">        |-- black-confirm</span><br><span class="line">        |   |-- black-confirm.scss</span><br><span class="line">        |   |-- black-confirm.vue</span><br><span class="line">        |-- common-neighbor-confirm</span><br><span class="line">        |   |-- common-neighbor-confirm.scss</span><br><span class="line">        |   |-- common-neighbor-confirm.vue</span><br><span class="line">        |-- relational-diffusion</span><br><span class="line">            |-- relational-diffusion.scss</span><br><span class="line">            |-- relational-diffusion.vue</span><br></pre></td></tr></table></figure></p>
<ul>
<li>common: 包含了图分析的通用组件、通用指令、一些菜单的枚举和组件名称的枚举、后端结构url、前端事件总线和一些工具方法如获得图片资源、注册全局组件等。</li>
<li>store: 该文件夹主要是定义了改工程的状态变量，和vuex相关的。</li>
<li>styles: 主要定义一些全局样式、或者是全局的通用类，比如去除浮动、省略文本等功能便于开发使用。</li>
<li>main.ts：工程的入口文件，主要功能有导入并use相应的第三方js包、导入全局样式、登录实例化并挂载根组件、全局组件注册、过滤器注册，全局指令注册等。</li>
</ul>
<h4 id="2-第三方包"><a href="#2-第三方包" class="headerlink" title="2. 第三方包"></a>2. 第三方包</h4><p>对于刚入门的同学来说，可能ts工程相对难一点，但是不要怕，看完我的文章之后你就可以很快的上手了。图分析主要引入的第三方包如下:</p>
<ul>
<li>bsview： 公司的UI组件库</li>
<li>vue-class-component： 官方推出的插件，有了它，vue就可以结合ts开发了，可以让你用类的方式开发组件。</li>
<li>vue-property-decorator：社区推出的插件，深度依赖vue-class-component,在它的基础上扩展了很多操作符比如@Prop、@Emit等等，应该说他是vue-class-component的super version,vue-property-decorator包中已经依赖了vue-class-component，所以我们开发的时候，只要下载vue-property-decorator。感兴趣的同学可以看看源码，里面主要涉及到了ts的装饰器的写法。</li>
<li>vuex-class: 结合vuex使用的，也是通过装饰器的方式扩展了vuex的一些方法操作符，如@State、@Mutation、@Action等等。</li>
<li>cytoscape: 可视化分析的图库，需要需要ES5和canvas支持，是一个纯JS编写的图库。</li>
<li>cytoscape-fcose：关联图谱布局算法库。</li>
<li>rxjs：一个响应式的编程库，有着纯函数的思想，采用了订阅发布模式，使你更容易的编写异步或者回调的代码。并且拥有这大量的管道流操作符，创建observable类方法，错误处理等。本工程中很多地方使用到了该库，很好的解决了事件总线、事件订阅、事件合并、函数防抖等功能。</li>
</ul>
<p>上面提到的第三方包请同学们多多熟悉它们的API,只有这样项目开发起来才能达到事半功倍的效果。</p>
<h4 id="3-事件总线和状态管理"><a href="#3-事件总线和状态管理" class="headerlink" title="3. 事件总线和状态管理"></a>3. 事件总线和状态管理</h4><h5 id="1-事件总线"><a href="#1-事件总线" class="headerlink" title="1. 事件总线"></a>1. 事件总线</h5><p>由于多个地方都可以控制右侧菜单栏组件的展开与收缩，相应子组件的加载，因此改项目大量使用到了事件总线的功能。本来想着使用Vuex并结合watch功能来实现，但是当变量值不变化的话，那么就不会触发watch,这样很难达到我的要求。其次使用new Vue()结合其emit/on,方法可行，但是功能太少，用起来太麻烦，并且会导致异步组件还没有渲染的情况下，还会接收不到之前发送的通知。因此最后我选用了RXJS，相关代码在bus.ts文件中：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> BehaviorSubject&lt;&#123;</span><br><span class="line">  parent: ComponentsName;</span><br><span class="line">  child: ComponentsName;</span><br><span class="line">  data?: any;</span><br><span class="line">&#125;&gt;(<span class="literal">null</span> <span class="keyword">as</span> any);</span><br><span class="line"><span class="keyword">const</span> busSubject = <span class="keyword">new</span> Subject&lt;&#123; <span class="attr">eventName</span>: EventName; data?: any &#125;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> enum EventName &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 节点详情</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  NODE_DETAIL = <span class="string">'node_detail'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关系过滤面版点击关系过滤列表的checkbox事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  RELATION_FILTER = <span class="string">'relation_filter'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 重要节点的显示隐藏事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  IMPORTANT_NODES = <span class="string">'important_nodes'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过name打开右边相应面版事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  OPEN_PANEL = <span class="string">'open_panel'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 查看对应的一条路径事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  QUERY_PATH = <span class="string">'query_path'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 相应的社团编号对应社团图事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  GROUP_GRAPH = <span class="string">'group_graph'</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 相应的规则编号对应的规则图事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  RULE_GRAPH = <span class="string">'rule_graph'</span>,</span><br><span class="line">  <span class="comment">/** 添加相应的元素到当前画布 */</span></span><br><span class="line">  ADD_ELEMENTS_TO_GRAPH = <span class="string">'addElementsToGraph'</span>,</span><br><span class="line">  <span class="comment">/** 黑节点状态改变 */</span></span><br><span class="line">  BLACK_STATUS_NODES_CHANGE = <span class="string">'blackStatusNodesChange'</span>,</span><br><span class="line">  <span class="comment">/** 更新菜单栏中的选中模式比如说多选或者是单选 */</span></span><br><span class="line">  SELECTION_TYPE = <span class="string">'selectionType'</span>,</span><br><span class="line">  <span class="comment">/** 更新共同邻居面版数据 */</span></span><br><span class="line">  UPDATE_COMMON_NEIGHBOR = <span class="string">'updateCommonNeighbor'</span>,</span><br><span class="line">  <span class="comment">/** 高亮元素 */</span></span><br><span class="line">  HIGHLIGHT_ELEMENTS = <span class="string">'highlightElements'</span>,</span><br><span class="line">  <span class="comment">/** 点亮高亮节点标签 */</span></span><br><span class="line">  UPDATE_COMMON_NEIGHBOR_LABEL = <span class="string">'updateCommonNeighborLabel'</span>,</span><br><span class="line">  <span class="comment">/** 点亮重要节点标签 */</span></span><br><span class="line">  UPDATE_IMPORTANT_LABEL = <span class="string">'updateImportantLabel'</span>,</span><br><span class="line">  <span class="comment">/** 模态框传值 */</span></span><br><span class="line">  MODAL = <span class="string">'modal'</span>,</span><br><span class="line">  <span class="comment">/** 一度关系 */</span></span><br><span class="line">  ONCE_RELATION = <span class="string">'onceRelation'</span>,</span><br><span class="line">  <span class="comment">/** 清空路径分析的查询结果 */</span></span><br><span class="line">  CLEAN_PATH_ANALYSIS_QUERY_RESULT = <span class="string">'cleanPathAnalysisQueryResult'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码比较简单，但是功能非常强大。我主要使用到了两个subject，一个BehaviorSubject用来控制右侧菜单栏组件中不同子组件的加载，一个Subject用来进行各个组件之间的信息通知。具体使用是通过EventEmit发送通知，和EventOn订阅通知两个接口暴露出来的，代码如下：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventEmit = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 控制打开相应右侧面版</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  openPanel(parent: ComponentsName, <span class="attr">child</span>: ComponentsName, data?: any) &#123;</span><br><span class="line">    subject.next(&#123; parent, child, data &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  bus(eventName: EventName, data?: any) &#123;</span><br><span class="line">    busSubject.next(&#123; eventName, data &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> EventOn = &#123;</span><br><span class="line">  openPanel(p?: ComponentsName, c?: ComponentsName) &#123;</span><br><span class="line">    <span class="keyword">return</span> subject.pipe(</span><br><span class="line">      filter(<span class="function"><span class="params">val</span> =&gt;</span> !!val),</span><br><span class="line">      filter(<span class="function">(<span class="params">&#123; parent, child &#125;</span>) =&gt;</span> (!p || p === parent) &amp;&amp; (!c || c === child))</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  bus(eName: EventName) &#123;</span><br><span class="line">    <span class="keyword">return</span> busSubject.pipe(</span><br><span class="line">      filter(<span class="function">(<span class="params">&#123; eventName &#125;</span>) =&gt;</span> eventName === eName),</span><br><span class="line">      map(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>其中openPanel对应着BehaviorSubject,控制各个右侧菜单栏子组件，bus对应着Subject用来信息通知和订阅。</p>
<h5 id="2-状态管理-vuex"><a href="#2-状态管理-vuex" class="headerlink" title="2. 状态管理-vuex"></a>2. 状态管理-vuex</h5><p>不管了，直接上代码store/index.ts文件夹下面：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> urlInfo: IUrlInfo = &#123;</span><br><span class="line">  sourceName: <span class="literal">null</span> <span class="keyword">as</span> any,</span><br><span class="line">  sourceId: <span class="string">''</span>,</span><br><span class="line">  graphEnv: <span class="literal">null</span> <span class="keyword">as</span> any,</span><br><span class="line">  graphId: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userInfo: IUserInfo = &#123;</span><br><span class="line">  userName: <span class="string">''</span>,</span><br><span class="line">  authorities: [],</span><br><span class="line">  mobile: <span class="string">''</span>,</span><br><span class="line">  roleNames: [],</span><br><span class="line">  userDisplayName: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> graphInfo: IGraphInfo = &#123;</span><br><span class="line">  commonNeighborNodes: &#123;</span><br><span class="line">    isShow: <span class="literal">false</span>,</span><br><span class="line">    data: []</span><br><span class="line">  &#125;,</span><br><span class="line">  importantNodes: &#123;</span><br><span class="line">    isShow: <span class="literal">false</span>,</span><br><span class="line">    data: []</span><br><span class="line">  &#125;,</span><br><span class="line">  selectedElements: &#123;</span><br><span class="line">    nodes: [],</span><br><span class="line">    edges: []</span><br><span class="line">  &#125;,</span><br><span class="line">  elements: &#123;</span><br><span class="line">    nodes: [],</span><br><span class="line">    edges: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store&lt;IState&gt;(&#123;</span><br><span class="line">  state: &#123; userInfo, graphInfo, urlInfo, <span class="attr">spinShow</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>vuex保存的主要由关于url的信息、用户的信息、图库的信息，其中图库信息主要包含了共同邻居节点、重要节点、选中的元素和画布的整个元素。其中共同邻居和重要节点中的isShow属性是用来控制它们对应标签的隐藏于展示。</p>
<h4 id="4-关联图谱画布-base-relation-graph"><a href="#4-关联图谱画布-base-relation-graph" class="headerlink" title="4. 关联图谱画布-base-relation-graph"></a>4. 关联图谱画布-base-relation-graph</h4><p>这个组件是整个工程的核心组件，代码结构如下：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|-- base-relation-graph</span><br><span class="line">    |-- base-relation-graph-operator.class.ts</span><br><span class="line">    |-- base-relation-graph.interface.ts</span><br><span class="line">    |-- base-relation-graph.scss</span><br><span class="line">    |-- base-relation-graph.service.ts</span><br><span class="line">    |-- base-relation-graph.vue</span><br><span class="line">    |-- context-menu</span><br><span class="line">    |   |-- context-menu.scss</span><br><span class="line">    |   |-- context-menu.vue</span><br><span class="line">    |-- styles</span><br><span class="line">        |-- base-relation-graph-base-style.ts</span><br><span class="line">        |-- base-relation-graph-nodes-style.ts</span><br></pre></td></tr></table></figure></p>
<h5 id="base-relation-graph-operator-class-ts"><a href="#base-relation-graph-operator-class-ts" class="headerlink" title="base-relation-graph-operator.class.ts"></a>base-relation-graph-operator.class.ts</h5><p>操作画布元素的一个类，该类实例化之后会作为属性传入给base-relation-graph.vue组件进行初始化画布。该类有很多操作画布元素的属性和方法，比如元素的添加，清除画布，布局、事件订阅等。<br>除了常规的属性和方法之外，还有一个canvas实现自定义画布，专门用来为画布元素添加一些标签，比如说重要节点、共同邻居、备注、扩展字段等标签。因为cytoscape.js的API对于节点边缘打上各种标记的功能支持不够好，一开始我找了一个第三方的库tippy.js,实现原理就是往页面中添加dom作为标签，但是如果节点过多的话，会导致性能急剧下降；所以我最终选择了自己去实现。主要代码如下：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">installCanvas(</span><br><span class="line">    canvasName: ECanvasNames,</span><br><span class="line">    zindex: string = <span class="string">'4'</span></span><br><span class="line">  ): &#123; <span class="attr">ctx</span>: CanvasRenderingContext2D; canvas: HTMLCanvasElement &#125; &#123;</span><br><span class="line">    <span class="keyword">const</span> labelCanvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    <span class="keyword">this</span>.context.cy.appendChild(labelCanvas);</span><br><span class="line">    labelCanvas.width = <span class="keyword">this</span>.context.cy.clientWidth;</span><br><span class="line">    labelCanvas.height = <span class="keyword">this</span>.context.cy.clientHeight;</span><br><span class="line">    labelCanvas.style.position = <span class="string">'absolute'</span>;</span><br><span class="line">    labelCanvas.style.zIndex = zindex;</span><br><span class="line">    labelCanvas.style.top = <span class="string">'0'</span>;</span><br><span class="line">    labelCanvas.style.left = <span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">const</span> canvasMap: ILabelCanvas = &#123;</span><br><span class="line">      ctx: <span class="keyword">this</span>.getCtx(labelCanvas),</span><br><span class="line">      canvas: labelCanvas,</span><br><span class="line">      isClear: <span class="literal">true</span>,</span><br><span class="line">      clear() &#123;</span><br><span class="line">        <span class="comment">/** 清空画布的专用技巧，比clearRect性能更高 */</span></span><br><span class="line">        <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>.canvas.width, <span class="keyword">this</span>.canvas.height);</span><br><span class="line">        <span class="keyword">this</span>.isClear = <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      draw(</span><br><span class="line">        callback: (</span><br><span class="line">          ctx: CanvasRenderingContext2D,</span><br><span class="line">          canvas: HTMLCanvasElement</span><br><span class="line">        ) =&gt; <span class="keyword">void</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.clear();</span><br><span class="line">        callback(<span class="keyword">this</span>.ctx, <span class="keyword">this</span>.canvas);</span><br><span class="line">        <span class="keyword">this</span>.isClear = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.nameToCanvas.set(canvasName, canvasMap);</span><br><span class="line">    <span class="keyword">return</span> canvasMap;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>我通过了一个nameToCanvas的一个Map容器来存储并管理每个创建的canvas,从上面代码可以看出，每次installCanvas的时候，会创建一个canvasMap对象，并set到nameToCanvas容器中。而canvasMap对象有两个方法，一个是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 为了每次进行draw的时候，就会自动判断是否去clear画布了，而不需要用户手动自己判断是否要clear了。</span><br><span class="line">2. 可以存储并管理各个画布实例的状态，比如3.4版本借助于标签位置实现悬浮事件。</span><br><span class="line">```javascript &#123;.line-numbers,.bolder&#125;</span><br><span class="line">/**</span><br><span class="line">   * @des 定义图谱的相关事件，返回值为Observable的Promise</span><br><span class="line">   * @param eventName 事件名称</span><br><span class="line">   */</span><br><span class="line">  onEventByName(eventName: string): Promise&lt;Observable&lt;EventObject&gt;&gt; &#123;</span><br><span class="line">    return new Promise&lt;Observable&lt;EventObject&gt;&gt;(resolve =&gt; &#123;</span><br><span class="line">      this.cy.batch(() =&gt; &#123;</span><br><span class="line">        resolve(</span><br><span class="line">          Observable.create((observer: Observer&lt;EventObject&gt;) =&gt; &#123;</span><br><span class="line">            this.cy.on(eventName, (event: EventObject) =&gt; &#123;</span><br><span class="line">              observer.next(event);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的一段代码主要是用来进行订阅图谱的相关事件的，通过Promise和Rxjs的Observable的结合，完美的把异步回调函数转化成了订阅发布的方式，这样不仅可以充分的使用rxjs的各种特性（防抖，节流，过滤，事件合并，额。。。，反正就是只有你想不到，没有它做不到，嘻嘻！），而且使得函数看起来更优雅和清晰。如果对前端小伙伴感兴趣的，可以研究一下Promise和Observable的特性，对技术提升很有帮助的哟！</p>
<h5 id="base-relation-graph-interface-ts"><a href="#base-relation-graph-interface-ts" class="headerlink" title="base-relation-graph.interface.ts"></a>base-relation-graph.interface.ts</h5><p>定义一些接口的文件</p>
<h5 id="styles文件夹"><a href="#styles文件夹" class="headerlink" title="styles文件夹"></a>styles文件夹</h5><p>初始化图谱的一些基本样式和节点的特殊样式。这里在base-relation-graph-nodes-style.ts文件中使用到了getImgUrl工具，代码如下：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder,highlight</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MarkNodeNames &#125; <span class="keyword">from</span> <span class="string">'../base-relation-graph.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NodeSize, NodeShape &#125; <span class="keyword">from</span> <span class="string">'../../App.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getImgUrl &#125; <span class="keyword">from</span> <span class="string">'@/graph-analysis/common/utils'</span>;</span><br><span class="line"><span class="keyword">const</span> getNodesImageUrl: any = getImgUrl.bind(<span class="literal">null</span>, <span class="string">'nodes'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> nodeStyleData = [</span><br><span class="line">  MarkNodeNames.chushibiaoji,</span><br><span class="line">  MarkNodeNames.chushihei,</span><br><span class="line">  MarkNodeNames.baozha,</span><br><span class="line">  MarkNodeNames.chaoda,</span><br><span class="line">  MarkNodeNames.chushibaozha,</span><br><span class="line">  MarkNodeNames.chushichaoda,</span><br><span class="line">  MarkNodeNames.gaoliang,</span><br><span class="line">  MarkNodeNames.biaoji,</span><br><span class="line">  MarkNodeNames.hei,</span><br><span class="line">  MarkNodeNames.danhua,</span><br><span class="line">  MarkNodeNames.chushigaoliang</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<p>getImgUrl在utils.ts文件中：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @des: 得到图分析的图片动态路径，可以通过bind柯里化函数</span></span><br><span class="line"><span class="comment"> * @author: yaojun</span></span><br><span class="line"><span class="comment"> * @date: 2019-12-16 16:20:34</span></span><br><span class="line"><span class="comment"> * @return:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getImgUrl</span>(<span class="params">...name: string[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">`@/assets/imgs/graph-analysis/<span class="subst">$&#123;name.reduce(</span></span></span><br><span class="line"><span class="string"><span class="subst">    (accumate, currentValue) =&gt; <span class="string">`<span class="subst">$&#123;accumate&#125;</span>/<span class="subst">$&#123;currentValue&#125;</span>`</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  )&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过以上代码的组合使用，形成了一套组合拳，通过bind方法的函数柯理化方式来进行参数的固化，来避免之后重复参数的传入。有兴趣也可以自行研究。</p>
<h5 id="context-menu"><a href="#context-menu" class="headerlink" title="context-menu"></a>context-menu</h5><p>看名称也知道这个组件的作用，其实就是在画布中点击鼠标右键弹出来的上下文菜单组件（支持拖拽功能）。其实这个组件放在这里不是很合适，因为这是个定制化比较强的组件，可能在每个场景下都有不同，所以通过slot插槽装载进来最好，而不是直接依赖在base-relation-graph.vue组件中。相关的优化我已经在3.4版本实现了，包括装饰器的防抖、避免不必要的大对象响应，大文件抽离（主要针对App.service.ts，下面会细说）优化等。</p>
<h4 id="5-右侧菜单栏组件-graph-analysis-right-menu"><a href="#5-右侧菜单栏组件-graph-analysis-right-menu" class="headerlink" title="5. 右侧菜单栏组件-graph-analysis-right-menu"></a>5. 右侧菜单栏组件-graph-analysis-right-menu</h4><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">|-- graph-analysis-right-menu</span><br><span class="line">    |-- graph-analysis-right-menu.scss</span><br><span class="line">    |-- graph-analysis-right-menu.vue</span><br><span class="line">    |-- analysis-result</span><br><span class="line">    |   |-- analysis-result.scss</span><br><span class="line">    |   |-- analysis-result.vue</span><br><span class="line">    |   |-- common-neighbor</span><br><span class="line">    |   |   |-- common-neighbor.scss</span><br><span class="line">    |   |   |-- common-neighbor.vue</span><br><span class="line">    |   |-- important-node</span><br><span class="line">    |   |   |-- important-node.scss</span><br><span class="line">    |   |   |-- important-node.vue</span><br><span class="line">    |   |-- path-analysis</span><br><span class="line">    |       |-- path-analysis.scss</span><br><span class="line">    |       |-- path-analysis.vue</span><br><span class="line">    |-- base-info</span><br><span class="line">    |   |-- base-info.scss</span><br><span class="line">    |   |-- base-info.vue</span><br><span class="line">    |   |-- detail</span><br><span class="line">    |   |   |-- detail.scss</span><br><span class="line">    |   |   |-- detail.service.ts</span><br><span class="line">    |   |   |-- detail.vue</span><br><span class="line">    |   |-- pie-graph</span><br><span class="line">    |   |   |-- pie-graph.vue</span><br><span class="line">    |   |-- relation-filtering</span><br><span class="line">    |   |   |-- relation-filtering.scss</span><br><span class="line">    |   |   |-- relation-filtering.vue</span><br><span class="line">    |   |-- statistics</span><br><span class="line">    |   |   |-- statistics.scss</span><br><span class="line">    |   |   |-- statistics.vue</span><br><span class="line">    |   |-- view-instruction</span><br><span class="line">    |       |-- view-instruction.scss</span><br><span class="line">    |       |-- view-instruction.vue</span><br><span class="line">    |-- checklist-rules</span><br><span class="line">    |   |-- checklist-rules.scss</span><br><span class="line">    |   |-- checklist-rules.vue</span><br><span class="line">    |-- club-discern</span><br><span class="line">    |   |-- club-discern.scss</span><br><span class="line">    |   |-- club-discern.vue</span><br><span class="line">    |   |-- table-expand-info</span><br><span class="line">    |       |-- table-expand-info.scss</span><br><span class="line">    |       |-- table-expand-info.vue</span><br><span class="line">    |-- common</span><br><span class="line">        |-- base-analysis-header</span><br><span class="line">            |-- base-analysis-header.scss</span><br><span class="line">            |-- base-analysis-header.vue</span><br></pre></td></tr></table></figure>
<p>右侧菜单栏组件各个子组件和子的子组件的文件夹呈现树状结构，这样做的好处是让开发者通过文件结构即可知道组件间的依赖关系。对应的相应面板如下图所示：</p>
<p><pre class="mermaid">graph LR
root(菜单栏面板)--> info(信息面板)
root --> analysis(分析结果面板)
root --> group(社团或者核查单面板)
info --> 详情
info --> 关系过滤
info --> 统计
info --> 试图说明
analysis --> 重要节点
analysis --> 共同邻居
analysis --> 路径分析</pre><br>右侧菜单栏组件及其子组件的代码实现都比较容易，主要是就是vuex状态管理进行初始化，订阅0penPanel，控制各个组件的隐藏展示，小伙伴可以自行研究，这里不在细说。</p>
<h4 id="6-App打头文件"><a href="#6-App打头文件" class="headerlink" title="6. App打头文件"></a>6. App打头文件</h4><p>除了App.scss文件控制样式外，如图若是：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|-- App-add-nodes.service.ts</span><br><span class="line">|-- App-context-menu.service.ts</span><br><span class="line">|-- App-header-menu.service.ts</span><br><span class="line">|-- App.interface.ts</span><br><span class="line">|-- App.service.ts</span><br><span class="line">|-- App.vue</span><br><span class="line">|-- event-on.service.ts</span><br></pre></td></tr></table></figure></p>
<p>上面文件共同承担着关联图谱用户操作的繁杂的业务逻辑，包括头部菜单的交互功能、上下文context-menu交互的功能，甚至是有的右侧菜单栏面板的交互功能。具体像节点的添加、淡化、更新pageRank值，关系名称过滤，录黑等等。<br>由于时间关系，这些代码没有很好的按照3.4规范来，其中App.service.ts更是达到了1000行代码，本应该根据功能进行抽离，但是由于时间问题，没来及进行相关方面的优化，这些缺点已经3.4版本得以解决。如果有小伙伴感兴趣，可以尝试着做一些代码或者是功能上的性能优化。<br>下面App.service.ts的一段代码，主要是把节点对象通过Es6的proxy进行包装成一个代理对象，从而可以对对象的各个属性活动进行监控并做出相应的业务处理。像Vue3.0的双向绑定原理就抛弃了Object.defineProperty使用了ES6的Proxy功能。<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代理节点</span></span><br><span class="line"><span class="comment"> * @param node</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getProxyByNode</span>(<span class="params">node: INode, context: IApp</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  node.position = <span class="keyword">new</span> <span class="built_in">Proxy</span>(node.position, &#123;</span><br><span class="line">    set: (</span><br><span class="line">      target: &#123; <span class="attr">x</span>: number; y: number &#125;,</span><br><span class="line">      key: string,</span><br><span class="line">      value: number,</span><br><span class="line">      receiver: any</span><br><span class="line">    ) =&gt; &#123;</span><br><span class="line">      updateCustomCanvas(context, node);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(node, &#123;</span><br><span class="line">    set: <span class="function">(<span class="params">target: INode, key: string, value: any, receiver: any</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/** 通过节点的typecode来自动改变节点的状态 */</span></span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">'typeCode'</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> markName: MarkNodeNames = <span class="string">''</span> <span class="keyword">as</span> any;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">parseInt</span>(value, <span class="number">2</span>)) &#123;</span><br><span class="line">          <span class="keyword">case</span> NodeType.tag:</span><br><span class="line">            markName = MarkNodeNames.biaoji;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceTag:</span><br><span class="line">            markName = MarkNodeNames.chushibiaoji;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.boomBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.hugeBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.tagBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.black:</span><br><span class="line">            markName = MarkNodeNames.hei;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceTagBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceBoomBlack:</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceHugeBlack:</span><br><span class="line">            markName = MarkNodeNames.chushihei;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.boom:</span><br><span class="line">            markName = MarkNodeNames.baozha;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceBoom:</span><br><span class="line">            markName = MarkNodeNames.chushibaozha;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.huge:</span><br><span class="line">            markName = MarkNodeNames.chaoda;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> NodeType.sourceHuge:</span><br><span class="line">            markName = MarkNodeNames.chushichaoda;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">/** 如果存在超大节点和其它节点状态并存的情况 */</span></span><br><span class="line">            <span class="keyword">if</span> (+value.charAt(<span class="number">0</span>)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (!+value.charAt(<span class="number">4</span>)) &#123;</span><br><span class="line">                markName = MarkNodeNames.chushichaoda;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                markName = MarkNodeNames.chaoda;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">/** 如果存在爆炸节点和其它节点状态并存的情况 */</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (+value.charAt(<span class="number">1</span>)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (!+value.charAt(<span class="number">4</span>)) &#123;</span><br><span class="line">                markName = MarkNodeNames.chushibaozha;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                markName = MarkNodeNames.baozha;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        context.graphOperator.markNodeByElements(</span><br><span class="line">          markName,</span><br><span class="line">          context.graphOperator.getElementById(target.id) <span class="keyword">as</span> NodeSingular</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">'isOpcaity'</span>) &#123;</span><br><span class="line">        context.graphOperator</span><br><span class="line">          .getElementById(target.id)</span><br><span class="line">          .data(<span class="string">'isOpcaity'</span>, value);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">'isSourceTagLabel'</span>) &#123;</span><br><span class="line">        <span class="comment">/** 异步保证sourceTagLabel属性在更新之后再进行运行扩散源标签的绘制 */</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          updateSourceTagLabels(context);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>比如说上面代码中，我对节点的位置进行了代理，如果position有变化，就会更新相应的canvas。</p>
<h4 id="7-表格tableFormat"><a href="#7-表格tableFormat" class="headerlink" title="7. 表格tableFormat"></a>7. 表格tableFormat</h4><p>之前对于表格的前后端处理方式是前端把表头的名称和相应的表头字段以hardcode形式写到代码中，后端只会传过来表格体的数据。这种做法相应的弊端就是如果表格增加或者修改删除一列，相应的前后端代码都得改，使得系统的伸缩性功能太低。现在关联图谱3.3定义了一种tableFormat格式，很好的解决了这个问题，所以以后如果是表格方面的数据，希望咱们前端可以和后端人员协调，让他们按照现在的tableFormat格式来进行传输。相关的用法可以参照club-discern.vue文件或者其它有表格的文件：<br><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers,.bolder&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> Vue.axios.get(URL_GROUP_LIST, &#123;</span><br><span class="line">      params: &#123;</span><br><span class="line">        limit: <span class="keyword">this</span>.pageSize,</span><br><span class="line">        start: <span class="keyword">this</span>.currentPage,</span><br><span class="line">        searchGroupId: <span class="keyword">this</span>.searchGroupId</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.tableData = convertTableFormatToBsViewTable(&#123;</span><br><span class="line">      ...data.groups,</span><br><span class="line">      types: &#123;</span><br><span class="line">        ...data.groups.types,</span><br><span class="line">        blackRate: <span class="function">(<span class="params">val: number</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;+val.toFixed(<span class="number">2</span>) * <span class="number">100</span>&#125;</span>%`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      excludeHeaders: [<span class="string">'blackCount'</span>, <span class="string">'distribute'</span>, <span class="string">'blackDistribute'</span>],</span><br><span class="line">      insertHeaders: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'expand'</span>,</span><br><span class="line">          width: <span class="number">35</span>,</span><br><span class="line">          render: <span class="function">(<span class="params">h: any, params: any</span>) =&gt;</span></span><br><span class="line">            h(TableExpandInfo, &#123;</span><br><span class="line">              props: &#123;</span><br><span class="line">                data: params.row</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      customHeaders: &#123;</span><br><span class="line">        blackRate: &#123;</span><br><span class="line">          width: <span class="number">65</span></span><br><span class="line">        &#125;,</span><br><span class="line">        communityId: &#123;</span><br><span class="line">          width: <span class="number">90</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.total = data.total;</span><br><span class="line">    <span class="keyword">this</span>.taskName = data.taskName;</span><br><span class="line">    <span class="keyword">this</span>.description = data.desc;</span><br><span class="line">    <span class="keyword">this</span>.defaultRow = <span class="keyword">this</span>.tableData.data.findIndex(</span><br><span class="line">      (&#123; communityId &#125;) =&gt; communityId === <span class="keyword">this</span>.currentId</span><br><span class="line">    );</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.sub) &#123;</span><br><span class="line">        <span class="keyword">this</span>.sub.unsubscribe();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.sub = fromEvent(</span><br><span class="line">        <span class="keyword">this</span>.clubDiscern.querySelectorAll(<span class="string">'.ivu-table-cell-expand'</span>),</span><br><span class="line">        <span class="string">'click'</span></span><br><span class="line">      ).subscribe(<span class="function">(<span class="params">e: Event</span>) =&gt;</span> &#123;</span><br><span class="line">        e.stopPropagation();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>上面的代码后端就是传输的tableFormat格式，前端再通过convertTableFormatToBsViewTable适配器工具转化成前端需要的数据，进行表格展示。convertTableFormatToBsViewTable适配器有很多处理表格数据的功能，代码相对来说比较简单，小伙伴可自行研究，也可增强其功能哟！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由于本人能力有限，代码或者是文档上有问题，大家可以向我提出意见，感激不尽！对于图谱的布局算法插件和表头菜单栏等组件在这里我就不单独拿出来说了，大家自行研究哈！如果你对布局算法感兴趣的话，可以研究一下，因为cytoscape.js可支持扩展插件，并且关联图谱定制化之后需要支持很多节点方面的不同算法布局。小伙伴可以写写插件，发发专利，一方面提升自己技能，另一方面也为公司做出了贡献，可谓是两全其美。<script src="https://cdn.bootcss.com/mermaid/7.1.2/mermaid.js"></script></p>

      
    </div>

    

    
    
    

    <div>
      
        
      
    </div>

    

    
       
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>你的支持是我继续创作的动力！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>求打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/webchat.png" alt="胖胖 微信扫一扫">
        <p>微信扫一扫</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/3232182962.html" rel="next" title="我的书签">
                <i class="fa fa-chevron-left"></i> 我的书签
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>

        </div>
      

      
      
    </footer>
  </div>
  
  
  
  <div>

<div>

    <div style="text-align:center;color: #ccc;font-size:15px;">----本文结束 <i class="fa fa fa-smile-o" style="font-size:24px;"></i> 感谢您的阅读----</div>

</div>


</div>

  </article>


  </div>


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.jpeg" alt="胖胖">
            
              <p class="site-author-name" itemprop="name">胖胖</p>
              <p class="site-description motion-element" itemprop="description">生命不息奋斗不止</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/xtylovesyj" title="GitHub &rarr; https://github.com/xtylovesyj" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:459828686@qq.com" title="E-Mail &rarr; mailto:459828686@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                学习园地
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.w3cplus.com/blogs/airen" title="https://www.w3cplus.com/blogs/airen" rel="noopener" target="_blank">Airen的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.zhangxinxu.com/wordpress/category/js/" title="https://www.zhangxinxu.com/wordpress/category/js/" rel="noopener" target="_blank">张鑫旭</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com/blog/javascript/" title="http://www.ruanyifeng.com/blog/javascript/" rel="noopener" target="_blank">阮一峰日志JS篇</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.liaoxuefeng.com/" title="https://www.liaoxuefeng.com/" rel="noopener" target="_blank">廖雪峰的官方网站</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://web.jobbole.com/category/javascript-2/" title="http://web.jobbole.com/category/javascript-2/" rel="noopener" target="_blank">伯乐在线</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/6584d42e4600" title="https://www.jianshu.com/u/6584d42e4600" rel="noopener" target="_blank">Layzimo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/bookmark/1230000012117582" title="https://segmentfault.com/bookmark/1230000012117582" rel="noopener" target="_blank">javascript深入系列</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/bookmark/1230000012117691" title="https://segmentfault.com/bookmark/1230000012117691" rel="noopener" target="_blank">javascript专题系列</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/bookmark/1230000012646912" title="https://segmentfault.com/bookmark/1230000012646912" rel="noopener" target="_blank">前端基础进阶系列文章</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.seosiwei.com/" title="https://blog.seosiwei.com/" rel="noopener" target="_blank">王微的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/minnanitkong" title="https://segmentfault.com/u/minnanitkong" rel="noopener" target="_blank">前端小智</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/evilboy" title="https://segmentfault.com/u/evilboy" rel="noopener" target="_blank">疯狂的技术宅</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/feleti" title="https://segmentfault.com/u/feleti" rel="noopener" target="_blank">周小肆</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/hyangteng" title="https://segmentfault.com/u/hyangteng" rel="noopener" target="_blank">hyangteng</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/senntyou" title="https://segmentfault.com/u/senntyou" rel="noopener" target="_blank">senntyou</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/langlixingzhou/articles?page=1&sort=vote" title="https://segmentfault.com/u/langlixingzhou/articles?page=1&sort=vote" rel="noopener" target="_blank">浪里行舟的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/meetbo/articles?sort=vote" title="https://segmentfault.com/u/meetbo/articles?sort=vote" rel="noopener" target="_blank">九死蚕传人bo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/u/chen93/articles?page=1&sort=vote" title="https://segmentfault.com/u/chen93/articles?page=1&sort=vote" rel="noopener" target="_blank">守候</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#工程说明"><span class="nav-text">工程说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源码目录设计"><span class="nav-text">源码目录设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图分析源码解析"><span class="nav-text">图分析源码解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-目录结构"><span class="nav-text">1. 目录结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-第三方包"><span class="nav-text">2. 第三方包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-事件总线和状态管理"><span class="nav-text">3. 事件总线和状态管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-事件总线"><span class="nav-text">1. 事件总线</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-状态管理-vuex"><span class="nav-text">2. 状态管理-vuex</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-关联图谱画布-base-relation-graph"><span class="nav-text">4. 关联图谱画布-base-relation-graph</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#base-relation-graph-operator-class-ts"><span class="nav-text">base-relation-graph-operator.class.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#base-relation-graph-interface-ts"><span class="nav-text">base-relation-graph.interface.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#styles文件夹"><span class="nav-text">styles文件夹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#context-menu"><span class="nav-text">context-menu</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-右侧菜单栏组件-graph-analysis-right-menu"><span class="nav-text">5. 右侧菜单栏组件-graph-analysis-right-menu</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-App打头文件"><span class="nav-text">6. App打头文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-表格tableFormat"><span class="nav-text">7. 表格tableFormat</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-text">总结</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">胖胖</span>

  

  
</div>
<!--

  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.5.0</div>

-->


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共24.6k字</span>
</div>

  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
        
      
  
  <script type="text/javascript" color="red" opacity="0.5" zindex="1000" count="999" src="true"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.5.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#more");
  
  </script>


  

  

</body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
